(function(c,n,q){function k(f,b){var a=this;a.options=b;a.itemCache={};var d=function(b){return a.options.i18n&&a.options.i18n[b]?a.options.i18n[b]:b};a.$moduleWrapper=c(f);a.$contentWrapper=c(".edn__articleListWrapper",a.$moduleWrapper);a.$header=c(".edn__myEvents_header",a.$moduleWrapper);a.$headerTitle=c(".edn__myEvents_title",a.$header);a.$visibleItemList=c(".edn__myEvents_visibleItemList",a.$moduleWrapper);a.$hiddenItemWrapper=c(".edn__myEvents_hiddenItemWrapper",a.$moduleWrapper);a.$hiddenItemList=
c(".edn__myEvents_hiddenItemList",a.$hiddenItemWrapper);a.$edn__myEvents_button_currentAndUpcoming=c(".edn__myEvents_button_currentAndUpcoming",a.$moduleWrapper);a.$edn__myEvents_button_allEvents=c(".edn__myEvents_button_allEvents",a.$moduleWrapper);a.itemCount=c(">",a.$visibleItemList).length;a.activeItemIndex=c("> .edn__myEvents_active",a.$visibleItemList).index();a.verticalLayout=a.$visibleItemList.hasClass("edn__myEvents_vertical");a.verticalLayout&&(a.$heightReference=c(".edn__myEvents_heightReference",
a.$moduleWrapper));var e="click fakeClick";a.$moduleWrapper.hasClass("edn__myEvents_hoverSwitch")&&(e+=" mouseenter");a.EventRegistration_Ashx_Action_Triggered=!1;a.$moduleWrapper.on("click",".edn__myEvents_hiddenItemWrapper .edn__myEvents_hiddenItemList >",function(){var b=c(this);b.addClass("edn__myEvents_active").siblings().removeClass("edn__myEvents_active");c("> .edn__myEvents_hide",a.$visibleItemList).eq(b.index()).trigger("fakeClick")}).on(e,".edn__myEvents_visibleItemList >",function(){var b=
c(this);b.addClass("edn__myEvents_active").siblings().removeClass("edn__myEvents_active");a.activeItemIndex=b.index();a.$moduleWrapper.removeClass("edn__myEvents_triggeredNextPage edn__myEvents_triggeredPreviousPage");h.call(a,b.data("meta").contentKey,1)}).on("click",".edn__myEvents_previousPage, .edn__myEvents_nextPage",function(){var b=c(this),d=!1;if(!b.hasClass("edn__myEvents_previousPage")||!a.$moduleWrapper.hasClass("edn__myEvents_disablePreviousPage")){if(b.hasClass("edn__myEvents_nextPage")){if(a.$moduleWrapper.hasClass("edn__myEvents_disableNextPage"))return;
d=!0;a.$moduleWrapper.addClass("edn__myEvents_triggeredNextPage").removeClass("edn__myEvents_triggeredPreviousPage")}else a.$moduleWrapper.addClass("edn__myEvents_triggeredPreviousPage").removeClass("edn__myEvents_triggeredNextPage");b=a.itemCache[a.options.filterEventsBy];var e=1;if(b){if(0>=b.totalItemCount)return;e=b.activePage}d?e++:e--;h.call(a,a.options.filterEventsBy,e)}}).on("click",".edn__myEvents_button_allEvents",function(){a.$edn__myEvents_button_allEvents.addClass("edn_active");a.$edn__myEvents_button_currentAndUpcoming.removeClass("edn_active");
a.options.filterEventsBy="allEvents";h.call(a,"allEvents",1)}).on("click",".edn__myEvents_button_currentAndUpcoming",function(){a.$edn__myEvents_button_allEvents.removeClass("edn_active");a.$edn__myEvents_button_currentAndUpcoming.addClass("edn_active");a.options.filterEventsBy="currentAndUpcoming";h.call(a,"currentAndUpcoming",1)}).on("click",".edn__myEvents_button_unregister",function(){var b=c(this).data("edsndata");b&&b.articleId&&!a.EventRegistration_Ashx_Action_Triggered&&(a.EventRegistration_Ashx_Action_Triggered=
!0,confirm(d("CancellationConfirmMsg.Text"))?c.ajax({type:"GET",url:a.options.websiteClientRoot+"DesktopModules/EasyDNNnews/ashx/EventRegistration.ashx",cache:!1,dataType:"json",timeout:15E3,data:{portalId:a.options.portalId,moduleId:a.options.moduleId,tabId:a.options.tabId,articleId:b.articleId,recurringId:b.recurringId,eventUserItemId:b.eventUserItemId,action:"unregister"}}).done(function(b,c){a.itemCache.currentAndUpcoming={pages:{},totalItemCount:-1,activePage:-1};a.itemCache.allEvents&&(a.itemCache.allEvents=
{pages:{},totalItemCount:-1,activePage:-1})}).always(function(){a.EventRegistration_Ashx_Action_Triggered=!1;h.call(a,a.options.filterEventsBy,1)}):a.EventRegistration_Ashx_Action_Triggered=!1)});a.itemCache.currentAndUpcoming={pages:{1:{content:a.$contentWrapper[0].outerHTML,loaded:!0,requesting:!1,requestError:!1}},totalItemCount:0==b.initialContentItemCount?1:b.initialContentItemCount,activePage:1};a.resize();m.call(a);a.$moduleWrapper.addClass("edn__myEvents_ready");a.$edn__myEvents_button_currentAndUpcoming&&
a.$edn__myEvents_button_currentAndUpcoming.addClass("edn_active");c(n).on("resize",function(){a.resize()})}var m=function(){var c=this;c.options.masonry&&c.$contentWrapper.isotope({sortBy:"original-order",masonry:{isFitWidth:!0}}).find("img").imagesLoaded().progress(function(){c.$contentWrapper.isotope("layout")})},l=function(f,b){var a=this,d=c(">",a.$visibleItemList).eq(a.activeItemIndex);if(!(0<d.length&&d.data("meta").contentKey!=f)){d=a.itemCache[f];var e=d.pages[b+""];d.activePage==b&&(a.$moduleWrapper.removeClass("edn__myEvents_pageReady").removeClass("edn__myEvents_loading").removeClass("edn__myEvents_noContent").removeClass("edn__myEvents_contentError").removeClass("edn__myEvents_disablePreviousPage").removeClass("edn__myEvents_disableNextPage"),
clearTimeout(a.pageReadyTimeout),a.pageReadyTimeout=setTimeout(function(){a.$moduleWrapper.addClass("edn__myEvents_pageReady")},100),0==d.totalItemCount?(a.$moduleWrapper.addClass("edn__myEvents_noContent"),a.verticalLayout&&a.resize()):-1==d.totalItemCount||!e.loaded&&e.requestError?(a.$moduleWrapper.addClass("edn__myEvents_contentError"),a.verticalLayout&&a.resize()):e.loaded&&(1==b&&a.$moduleWrapper.addClass("edn__myEvents_disablePreviousPage"),Math.ceil(d.totalItemCount/a.options.itemsPerPage)<=
b&&a.$moduleWrapper.addClass("edn__myEvents_disableNextPage"),a.$contentWrapper.replaceWith(e.content),a.$contentWrapper=c(".edn__articleListWrapper",a.$moduleWrapper),m.call(a),a.verticalLayout&&a.resize()))}},h=function(f,b){var a=this,d=a.itemCache[f],e;d||(d={pages:{},totalItemCount:-1,activePage:-1},a.itemCache[f]=d);1>b&&(b=1);if(-1!=d.totalItemCount){var g=Math.ceil(d.totalItemCount/a.options.itemsPerPage);b>g&&(b=g)}d.activePage=b;if(0==d.totalItemCount)l.call(a,f,b);else{g=b+"";if(e=d.pages[g]){if(e.loaded){l.call(a,
f,b);return}if(e.requesting){a.$moduleWrapper.addClass("edn__myEvents_loading");return}}else d.pages[g]=e={content:"",loaded:!1,requesting:!0,requestError:!1};-1==d.totalItemCount&&a.$moduleWrapper.addClass("edn__myEvents_disablePreviousPage edn__myEvents_disableNextPage");a.$moduleWrapper.addClass("edn__myEvents_loading");e.requesting=!0;var h=!1,k=-1==d.totalItemCount;g={portalId:a.options.portalId,moduleId:a.options.moduleId,tabId:a.options.tabId,contentKey:f,contentPage:b,getPaginationMeta:k,
localeCode:a.options.localeCode,filterEventsBy:a.options.filterEventsBy};a.options.localeCode&&c.extend(g,{localeCode:a.options.localeCode});c.ajax({type:"GET",url:a.options.websiteClientRoot+"DesktopModules/EasyDNNnews/ashx/GetEventsList.ashx",cache:!1,dataType:"json",timeout:15E3,data:g}).done(function(a,b){h=!0;"nocontent"!=b&&c.isPlainObject(a)?(k&&(d.totalItemCount=0==a.contentCount?1:a.contentCount),e.content=a.contentHtml):d.totalItemCount=0;e.loaded=!0}).fail(function(a,b){}).always(function(){e.requesting=
!1;e.requestError=!h;l.call(a,f,b)})}};k.prototype={resize:function(f){var b=this,a=!1;c(">",b.$visibleItemList).removeClass("edn__myEvents_hide");if(b.verticalLayout){if(0==b.$heightReference.length)return;var d=b.$heightReference.outerHeight(!0);if(b.$visibleItemList.outerHeight(!0)>d){a=!0;var e=b.itemCount-1;for(b.$hiddenItemList.empty();0<=e&&b.$visibleItemList.outerHeight(!0)>d;){var g=c(">",b.$visibleItemList).eq(e);g.addClass("edn__myEvents_hide");b.$hiddenItemList.prepend(g.clone(!0));e--}}clearTimeout(b.reResizeTimeout);
f||(b.reResizeTimeout=setTimeout(function(){b.resize(!0)},1E3))}else if(f=b.$header.innerWidth()-(0==b.$headerTitle.length?0:b.$headerTitle.outerWidth(!0))-20,b.$visibleItemList.outerWidth(!1)>f)for(a=!0,e=b.itemCount-1,b.$hiddenItemList.empty();0<=e&&b.$visibleItemList.outerWidth(!1)>f;)g=c(">",b.$visibleItemList).eq(e),g.addClass("edn__myEvents_hide"),b.$hiddenItemList.prepend(g.clone(!0)),e--;a?(b.$visibleItemList.addClass("edn__myEvents_itemsHidden"),b.$hiddenItemWrapper.addClass("edn__myEvents_itemsHidden")):
			(b.$visibleItemList.removeClass("edn__myEvents_itemsHidden"), b.$hiddenItemWrapper.removeClass("edn__myEvents_itemsHidden"))
	}
	}; var p = { websiteClientRoot: "/", portalId: 0, moduleId: 0, tabId: 0, itemsPerPage: 5, initialContentItemCount: 0, masonry: !1, filterEventsBy: "currentAndUpcoming" }; c.fn.edNewsMyEvents = function (f) { f = c.extend({}, p, f); return this.each(function () { var b = c(this); b.data("edNewsMyEvents") || b.data("edNewsMyEvents", new k(this, f)) }) }
})(eds3_5_jq,window);