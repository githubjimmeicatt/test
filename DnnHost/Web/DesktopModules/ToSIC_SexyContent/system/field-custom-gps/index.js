!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";this&&this.__spreadArrays;Object.defineProperty(t,"__esModule",{value:!0}),t.consoleLogWebpack=void 0,t.consoleLogWebpack=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapsApiUrl=t.defaultCoordinates=void 0,t.defaultCoordinates={lat:47.17465989999999,lng:9.469142499999975};t.mapsApiUrl=function(){var e="https://maps.googleapis.com/maps/api/js?key=";return e&&(e+="AIzaSyDPhn"),e&&(e+="NKpEg8FmY8nooE7Zwnue6SusxEnHE"),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyLatLng=t.parseLatLng=t.buildTemplate=t.customGpsIcons=void 0;var i=n(6);t.customGpsIcons={mapMarker:i.default},t.buildTemplate=function(e,t){return e+"<style>\n"+t+"\n</style>"},t.parseLatLng=function(e){return JSON.parse(e.replace("latitude","lat").replace("longitude","lng"))},t.stringifyLatLng=function(e){return JSON.stringify(e).replace("lat","latitude").replace("lng","longitude")}},function(e,t,n){n(4),e.exports=n(9)},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),a=n(0),s=n(1),l=n(2),c=n(7),p=n(8),d="field-custom-gps-dialog",u=function(e){function t(){var t=e.call(this)||this;return a.consoleLogWebpack(d+" constructor called"),t.fieldInitialized=!1,t}return o(t,e),t.prototype.connectedCallback=function(){var e=this;if(!this.fieldInitialized){this.fieldInitialized=!0,a.consoleLogWebpack(d+" connectedCallback called"),this.eventListeners=[],this.mapApiUrl=s.mapsApiUrl(),this.innerHTML=l.buildTemplate(c.default,p.default),this.latInput=this.querySelector("#lat"),this.lngInput=this.querySelector("#lng");var t=this.querySelector("#address-mask-container");this.iconSearch=this.querySelector("#icon-search");var n=this.querySelector("#formatted-address-container");this.mapContainer=this.querySelector("#map");var i=this.connector._experimental.allInputTypeNames.map((function(e){return e.name}));i.includes(this.connector.field.settings.LatField)&&(this.latFieldName=this.connector.field.settings.LatField),i.includes(this.connector.field.settings.LongField)&&(this.lngFieldName=this.connector.field.settings.LongField);var o=this.connector.field.settings.AddressMask||this.connector.field.settings["Address Mask"];this.addressMask=new r.FieldMask(o,this.connector._experimental.formGroup.controls,null,null),a.consoleLogWebpack(d+" addressMask:",o),o&&(t.classList.remove("hidden"),n.innerText=this.addressMask.resolve()),this.connector.loadScript("google",this.mapApiUrl,(function(){e.mapScriptLoaded()}))}},t.prototype.mapScriptLoaded=function(){var e=this;a.consoleLogWebpack(d+" mapScriptLoaded called"),this.map=new google.maps.Map(this.mapContainer,{zoom:15,center:s.defaultCoordinates,gestureHandling:"greedy"}),this.marker=new google.maps.Marker({position:s.defaultCoordinates,map:this.map,draggable:!0}),this.geocoder=new google.maps.Geocoder,this.connector.data.value?this.updateHtml(l.parseLatLng(this.connector.data.value)):this.updateHtml(s.defaultCoordinates);var t=function(){e.onLatLngInputChange()};this.latInput.addEventListener("change",t),this.lngInput.addEventListener("change",t);var n=function(){e.autoSelect()};this.iconSearch.addEventListener("click",n),this.eventListeners.push({element:this.latInput,type:"change",listener:t},{element:this.lngInput,type:"change",listener:t},{element:this.iconSearch,type:"click",listener:n}),this.marker.addListener("dragend",(function(t){e.onMarkerDragend(t)}))},t.prototype.updateHtml=function(e){var t,n,i,o;this.latInput.value=null!==(n=null===(t=e.lat)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",this.lngInput.value=null!==(o=null===(i=e.lng)||void 0===i?void 0:i.toString())&&void 0!==o?o:"",this.map.setCenter(e),this.marker.setPosition(e)},t.prototype.updateForm=function(e){this.connector.data.update(l.stringifyLatLng(e)),this.latFieldName&&this.connector._experimental.updateField(this.latFieldName,e.lat),this.lngFieldName&&this.connector._experimental.updateField(this.lngFieldName,e.lng)},t.prototype.onLatLngInputChange=function(){a.consoleLogWebpack(d+" input changed");var e={lat:this.latInput.value.length>0?parseFloat(this.latInput.value):null,lng:this.lngInput.value.length>0?parseFloat(this.lngInput.value):null};this.updateHtml(e),this.updateForm(e)},t.prototype.autoSelect=function(){var e=this;a.consoleLogWebpack(d+" geocoder called");var t=this.addressMask.resolve();this.geocoder.geocode({address:t},(function(n,i){if(i===google.maps.GeocoderStatus.OK){var o=n[0].geometry.location,r={lat:o.lat(),lng:o.lng()};e.updateHtml(r),e.updateForm(r)}else alert("Could not locate address: "+t)}))},t.prototype.onMarkerDragend=function(e){a.consoleLogWebpack(d+" marker changed");var t={lat:e.latLng.lat(),lng:e.latLng.lng()};this.updateHtml(t),this.updateForm(t)},t.prototype.disconnectedCallback=function(){a.consoleLogWebpack(d+" disconnectedCallback called"),null===google||void 0===google||google.maps.event.clearInstanceListeners(this.marker),null===google||void 0===google||google.maps.event.clearInstanceListeners(this.map),this.eventListeners.forEach((function(e){var t=e.element,n=e.type,i=e.listener;t.removeEventListener(n,i)}))},t}(HTMLElement);customElements.get(d)||customElements.define(d,u)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FieldMask=void 0;var i=function(){function e(e,t,n,i,o){this.changeEvent=n,this.eavConfig=o,this.fields=[],this.findFields=/\[.*?\]/gi,this.unwrapField=/[\[\]]/gi,this.subscriptions=[],this.mask=e,this.model=t,this.fields=this.fieldList(),i&&(this.preClean=i),t&&n&&this.watchAllFields()}return e.prototype.resolve=function(){var e=this,t=this.mask;return null!=this.eavConfig&&null!=t&&(t=(t=t.replace("[App:AppId]",this.eavConfig.appId)).replace("[App:ZoneId]",this.eavConfig.zoneId)),this.fields.forEach((function(n,i){var o=e.model.hasOwnProperty(n)&&e.model[n]&&e.model[n].value?e.model[n].value:"",r=e.preClean(n,o);t=t.replace("["+n+"]",r)})),t},e.prototype.fieldList=function(){var e=this,t=[];if(!this.mask)return t;var n=this.mask.match(this.findFields);return n?n.forEach((function(n,i){var o=n.replace(e.unwrapField,"");t.push(o)})):t.push(this.mask),t},e.prototype.preClean=function(e,t){return t},e.prototype.onChange=function(){var e=this.resolve();this.value!==e&&this.changeEvent(e),this.value=e},e.prototype.watchAllFields=function(){var e=this;this.fields.forEach((function(t){if(e.model[t]){var n=e.model[t].valueChanges.subscribe((function(t){return e.onChange()}));e.subscriptions.push(n)}}))},e.prototype.destroy=function(){this.subscriptions.forEach((function(e){e.unsubscribe()}))},e}();t.FieldMask=i},function(e,t,n){"use strict";n.r(t),t.default='<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marker-alt" class="svg-inline--fa fa-map-marker-alt fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"></path></svg>'},function(e,t,n){"use strict";n.r(t),t.default='<div class="custom-gps-container">\r\n  <div class="map-info">\r\n    <div class="input-component">\r\n      <label for="lat">Lat:</label>\r\n      <input id="lat" type="number" step="0.001" />\r\n    </div>\r\n    &nbsp;\r\n    <div class="input-component">\r\n      <label for="lng">Lng:</label>\r\n      <input id="lng" type="number" step="0.001" />\r\n    </div>\r\n  </div>\r\n\r\n  <div id="address-mask-container" class="map-info address-mask-container hidden">\r\n    <a id="icon-search" class="btn">\r\n      <i class="material-icons-outlined">search</i>\r\n    </a>\r\n    <span id="formatted-address-container"></span>\r\n  </div>\r\n\r\n  <div id="map" class="map-info__map"></div>\r\n</div>\r\n'},function(e,t,n){"use strict";n.r(t),t.default=".custom-gps-container{display:flex;flex-direction:column;height:100%}.map-info{flex:0 0 32px;display:flex;flex-wrap:wrap;align-items:center;padding:4px;padding-left:14px;border-bottom:1px solid #e1e1e1;background:#fff}.map-info label,.map-info #icon-search{margin-right:8px;display:flex;justify-content:center;align-items:center;font-size:12px;text-transform:uppercase;padding:4px}.map-info #icon-search i{font-size:14px;width:14px;height:14px;font-weight:bold}.map-info input{margin-right:8px;padding:4px 16px;border:none;background:transparent;outline:none !important}.address-mask-container{flex-wrap:nowrap}.map-info__map{flex:1 1 auto;width:100%;display:block}.hidden{display:none}.btn{border:1px solid silver;border-radius:4px}.btn:hover{background-color:rgba(69,79,99,.08);cursor:pointer}.input-component{display:flex;background-color:rgba(69,79,99,.08);padding:4px;border-radius:4px 4px 0 0;border-bottom:1px solid silver;margin:8px 0}.input-component:hover{border-bottom:1px solid #0087f4}"},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(1),s=n(2),l=n(10),c=n(11),p="field-custom-gps",d=function(e){function t(){var t=e.call(this)||this;return r.consoleLogWebpack(p+" constructor called"),t.fieldInitialized=!1,t}return o(t,e),t.prototype.connectedCallback=function(){var e=this;if(!this.fieldInitialized){this.fieldInitialized=!0,r.consoleLogWebpack(p+" connectedCallback called"),this.innerHTML=s.buildTemplate(l.default,c.default),this.querySelector("#map-icon-container").innerHTML=s.customGpsIcons.mapMarker,this.latContainer=this.querySelector("#lat-container"),this.lngContainer=this.querySelector("#lng-container"),this.eventListeners=[];var t=function(){e.expand()};this.addEventListener("click",t),this.eventListeners.push({element:this,type:"click",listener:t}),this.connector.data.value?this.updateHtml(s.parseLatLng(this.connector.data.value)):this.updateHtml(a.defaultCoordinates),this.connector.data.onValueChange((function(t){if(t){var n=s.parseLatLng(t);e.updateHtml(n)}else e.updateHtml(a.defaultCoordinates)}))}},t.prototype.updateHtml=function(e){var t,n,i,o;this.latContainer.innerText=null!==(n=null===(t=e.lat)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",this.lngContainer.innerText=null!==(o=null===(i=e.lng)||void 0===i?void 0:i.toString())&&void 0!==o?o:""},t.prototype.expand=function(){this.connector.dialog.open()},t.prototype.disconnectedCallback=function(){r.consoleLogWebpack(p+" disconnectedCallback called"),this.eventListeners.forEach((function(e){var t=e.element,n=e.type,i=e.listener;t.removeEventListener(n,i)}))},t}(HTMLElement);customElements.get(p)||customElements.define(p,d)},function(e,t,n){"use strict";n.r(t),t.default='<div class="custom-gps-preview">\r\n  <div class="custom-gps-preview__text">\r\n    Lat: <span id="lat-container"></span>, Lng: <span id="lng-container"></span>\r\n  </div>\r\n  <div class="custom-gps-preview__spacer"></div>\r\n  <div id="map-icon-container" class="custom-gps-preview__map-icon"></div>\r\n</div>\r\n'},function(e,t,n){"use strict";n.r(t),t.default=".custom-gps-preview{width:100%;display:flex;align-items:center;position:absolute;top:0;bottom:0;font-size:16px;line-height:20px;margin-bottom:-2px;cursor:pointer}.custom-gps-preview__text{flex-shrink:0;max-width:80%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.custom-gps-preview__spacer{flex-grow:1}.custom-gps-preview__map-icon{flex-shrink:0;margin-right:4px;display:flex;align-items:center;justify-content:center}.custom-gps-preview__map-icon svg{width:20px;height:20px;line-height:20px}"}]);
//# sourceMappingURL=https://sources.2sxc.org/11.22.00/system/field-custom-gps/index.js.map