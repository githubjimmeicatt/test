!function(e,t){"use strict";var a={portalId:0,moduleId:0,tabId:0,autoplayVideo:!1,userLoggedIn:!1,googleReCaptchaSiteKey:"",websiteRoot:"",portfolioMode:!1,openAt:0,wrapperResizeDuration:200,flowplayerSwf:"",flowplayer:{key:"",logo:""},socialButtons:{facebook:!1,gplus:!1,twitter:!1,inshare:!1,pinterest:!1},cssClass:"",events:{onBeforeClose:function(){}},comments:{requireAuthorInfo:!0,useReCaptcha:!1,permissions:{show:!1,commenting:!1}},like:{permissions:{liking:!1}},mobile:!1,i18n:{}},o=0,i=1,s=2,n="positionAnimation",r="swipeAnimation",m=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,l=function(t,a){var o=this,i=o.items[t];if(i&&"image"==i.type){var s=o.images[i.src];if(s)"function"==typeof a&&(s.stats.preloadFinished?a(s.stats):s.callbacks.push(a));else{s=o.images[i.src]={callbacks:[],stats:{preloadFinished:!1,isLoaded:!1,width:0,height:0}},"function"==typeof a&&s.callbacks.push(a);var n=e('<img class="smbLightImage_'+i.id+'" />');n.imagesLoaded().progress(function(e,t){if(!o.viewClosed){var a=o.images[i.src];if(a.stats.preloadFinished=!0,a.stats.isLoaded=t.isLoaded,!o.smbPlus&&t.isLoaded&&o.$imagesWrapper.append(n),a.stats.width=n.width(),a.stats.height=n.height(),o.smbPlus)n.css(p.call(o,a.stats.width,a.stats.height,!1)),n.parent().removeClass("loading");else{var s=o.items[o.currentItemIndex];"image"==s.type&&s.src==i.src&&(o.initialItemLoaded=!0,$.call(o))}n=null;for(var r=0,m=a.callbacks.length;r<m;r++)a.callbacks[r](a.stats)}}),o.smbPlus&&n.appendTo(e("> div.item_"+t,o.$contentWrapper)),n.attr("src",i.src)}}},c=function(){for(var e=0,t=this.items.length;e<t;e++)l.call(this,e)},p=function(e,t,a,o){var i,s,n=this.overlayWidth-this.main.horizontalSpace,r=this.overlayHeight-this.main.verticalSpace,m=e,l=t;return(a||e>n||t>r)&&(m=n,l=r,(s=e/t)<(i=n/r)?m=Math.round(r/t*e):s>i&&(l=Math.round(n/e*t))),o&&(l=t),{width:m,height:l,top:Math.floor((r-l)/2),left:Math.floor((n-m)/2)}},d=function(e){var t=this,a=function(){t.$loadingOverlay.stop(!0).fadeTo(200,0,function(){t.$loadingOverlay.css("display","none")}),v.call(t)},o=function(e,a){0==t.options.wrapperResizeDuration?(t.$mainWrapper.css(e),a()):t.$mainWrapper.stop(!0).animate(e,{duration:t.options.wrapperResizeDuration,complete:function(){t.$mainWrapper.css("overflow",""),a()}})},i=function(){t.$mainWrapper.height()!=e.height?o({height:e.height,top:e.top},a):a()};t.$loadingOverlay.removeClass("inProgress"),t.$mainWrapper.width()!=e.width?o({width:e.width,left:e.left},i):i()},h=function(t){var a="",o="",i=this.items[t];switch(this.smbPlus||this.$mainWrapper.addClass("videoItem"),i.source){case"youtube":a='<iframe src="//www.youtube.com/embed/'+i.videoId+(this.options.autoplayVideo?"?autoplay=1":"")+'" frameborder="0" allowfullscreen></iframe>';break;case"vimeo":a='<iframe src="//player.vimeo.com/video/'+i.videoId+(this.options.autoplayVideo?"?autoplay=1":"")+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';break;case"wistia":a='<iframe name="wistia_embed" src="//fast.wistia.net/embed/iframe/'+i.videoId+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';break;case"flowplayer":W(i.src,".mp4")?o="video/mp4":W(i.src,".webm")?o="video/webm":W(i.src,".ogg")?o="video/ogg":W(i.src,".flv")&&(o="video/flash"),a='<div class="flowplayerContainer"></div>'}var s=this.$audioVideo;this.smbPlus?("flowplayer"!=i.source&&(a="<div>"+a+"</div>"),s=e("> div.item_"+this.currentItemIndex,this.$contentWrapper)):s.addClass("activeElement"),s.html(a).removeClass("loading"),"flowplayer"==i.source&&e("> .flowplayerContainer",s).flowplayer({swf:this.options.flowplayerSwf,ratio:i.height/i.width,autoplay:this.options.autoplayVideo,tooltip:!1,embed:!1,clip:{sources:[{type:o,src:i.src}]},key:this.options.flowplayer.key,logo:this.options.flowplayer.logo});var n=p.call(this,i.width,i.height,!0);this.smbPlus?e(">",s).css(n):d.call(this,n),this.initialItemLoaded=!0},u=function(t){this.smbPlus||this.$mainWrapper.addClass("audioItem");var a=this.$audioVideo,o='<audio src="'+t.src+'" />',i="> audio";this.smbPlus?(o="<div>"+o+"</div>",i="> div > audio",a=e("> div.item_"+this.currentItemIndex,this.$contentWrapper)):a.addClass("activeElement"),a.html(o).removeClass("loading"),audiojs.create(e(i,a)[0]);var s=p.call(this,460,36,!1,!0);this.smbPlus?e(">",a).css(s):d.call(this,s),this.initialItemLoaded=!0},v=function(){var e=this.items[this.currentItemIndex];"string"==typeof e.title&&""!=e.title&&this.$itemTitle.html(e.title).stop(!0).fadeTo(200,1),(this.options.socialButtons.facebook||this.options.socialButtons.twitter||this.options.socialButtons.gplus||this.options.socialButtons.inshare||this.options.socialButtons.pinterest&&"image"==e.type)&&"string"==typeof e.socialUrl&&""!=e.socialUrl?this.$socialButtonsTrigger.css("display",""):this.$socialButtonsTrigger.css("display","none")},g=function(e){var t=this.items.length;return e<0?e=t-1:e>=t&&(e=0),e},$=function(){if(this.$itemTitle.text("").stop(!0).fadeTo(0,0),this.$socialButtonsTrigger.removeClass("show"),this.$socialButtonsWrapper.removeClass("show").html(""),this.currentItemIndex=g.call(this,this.currentItemIndex),this.$root.removeClass("firstItem lastItem"),0===this.currentItemIndex&&this.$root.addClass("firstItem"),this.currentItemIndex===this.items.length-1&&this.$root.addClass("lastItem"),this.smbPlus){var t=g.call(this,this.currentItemIndex-1),a=g.call(this,this.currentItemIndex+1);e("> div.videoItem.item_"+t+",> div.audioItem.item_"+t+",> div.videoItem.item_"+a+",> div.audioItem.item_"+a,this.$contentWrapper).html(""),v.call(this)}var o=this.items[this.currentItemIndex],i="imageActive";"video"==o.type?i="videoActive":"audio"==o.type&&(i="audioActive"),this.$root.removeClass("imageActive videoActive audioActive").addClass(i),this.showItem()},C=function(){if(this.smbPlus){var e=this.$window.height();t.innerHeight&&(e=t.innerHeight),e+=1,this.$root.height(e),this.overlayWidth=this.$root.width(),this.overlayHeight=e}else this.overlayWidth=this.$contentWrapper.width(),this.overlayHeight=this.$contentWrapper.height();this.center()},f=function(e){var t=this;if(!(t.skipGestures||-1==e&&0==t.currentItemIndex||1==e&&t.currentItemIndex==this.items.length-1)){t.skipGestures=!0;var a=-t.currentItemIndex*t.overlayWidth;1==e?a-=t.overlayWidth:a+=t.overlayWidth,t.$contentWrapper.removeClass(n).addClass(r).css({transform:"translate3d("+a+"px, 0, 0)"}),setTimeout(function(){t.currentItemIndex+=e,$.call(t),t.skipGestures=!1},250)}},I=function(){this.initialItemLoaded&&(this.smbPlus?f.call(this,-1):(this.currentItemIndex-=1,$.call(this)))},y=function(){this.initialItemLoaded&&(this.smbPlus?f.call(this,1):(this.currentItemIndex+=1,$.call(this)))},w=function(){var e=this;"function"==typeof e.options.events.onBeforeClose&&!1===e.options.events.onBeforeClose({activeItem:e.currentItemIndex,displayItems:e.items})||(e.$document.off(".smbLightEvent"),e.$window.off(".smbLightEvent"),e.viewClosed=!0,e.$root.stop(!0).fadeOut(200,function(){e.$root.remove(),e.$body.removeClass("smbLightFixed")}),e.smbPlus&&(void 0===e.oldViewportMetaContent?e.$viewportMeta.remove():e.$viewportMeta.attr("content",e.oldViewportMetaContent),void 0===e.oldIeTapHighlight?e.$ieTapHighlight.remove():e.$ieTapHighlight.attr("content",e.oldIeTapHighlight)))},W=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},k=function(){var t=this,a=t.items[t.currentItemIndex],o=t.comments[a.id],i="";if(t.$mainCommentsCount.text(o.count),t.$internalCommentsCount.text(o.count),0==o.cache.comments.length)return t.$commentList.html(""),void t.$commentsModal.addClass("noComments");t.$commentsModal.removeClass("noComments"),e.each(o.cache.comments,function(){var a=o.cache.authors[this.author],s=encodeURI(a.url),n='<li><a class="authorAvatar" href="'+s+'"><img src="'+encodeURI(a.avatar)+'" alt="" /></a><a class="author" href="'+s+'">'+e("<p />").text(a.name).html()+"</a><div>"+this.content+'</div><p class="datetime">'+this.dateHtml+"</p></li>";"asc"==t.commentSorting?i+=n:i=n+i}),t.$commentList.html(i)},b=function(o,i){return this.$body=e("body"),!this.$body.hasClass("smbLightFixed")&&0!=o.length&&(this.$body.addClass("smbLightFixed"),this.$window=e(t),this.$document=e(document),this.initialItemLoaded=!1,this.viewClosed=!1,this.items=o,this.options=e.extend(!0,{},a,i),this.currentItemIndex=this.options.openAt,(this.currentItemIndex<0||this.currentItemIndex>=o.length)&&(this.currentItemIndex=0),this.images={},!0)},x=function(){var t=this;t.$window.on("resize.smbLightEvent",function(){if(t.comments){var e=t.items[t.currentItemIndex],a=t.comments?t.comments[e.id]:void 0;t.desktopVersion&&a&&a.state.open&&t.$root.width(t.$window.width()-t.$commentsModal.outerWidth(!0))}C.call(t)}),t.$document.on("keyup.smbLightEvent",function(e){switch(e.keyCode){case 37:I.call(t);break;case 39:y.call(t);break;case 27:if(t.commentsOpened)return t.closeComments(),!1;w.call(t)}return!1}),t.$root.on("click",".navigation",function(){t.$root.hasClass("initializing")||(e(this).hasClass("prev")?I.call(t):y.call(t))}).on("click",".close",function(){w.call(t)}),t.$socialButtonsTrigger.on("click",function(){if(!t.$root.hasClass("initializing")){var a=t.items[t.currentItemIndex],o=encodeURIComponent(a.socialUrl),i="",s="";"string"==typeof a.title&&""!=a.title&&(s=a.title.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s+=" "+a.socialUrl.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=encodeURIComponent(a.title));var n="";t.options.socialButtons.facebook&&(n='<div><iframe src="//www.facebook.com/plugins/like.php?href='+o+'&amp;width&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;share=false&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:21px; width: 135px;" allowTransparency="true"></iframe></div>'),t.options.socialButtons.twitter&&(n+='<div><a href="//twitter.com/share" class="twitter-share-button" data-url="'+o+'" data-text="'+s+'">Tweet</a><script type="text/javascript">twttr.widgets.load();<\/script></div>'),t.options.socialButtons.gplus&&(n+='<div><div class="g-plusone" data-size="medium" data-href="'+a.socialUrl+'"></div><script type="text/javascript">gapi.plusone.go();<\/script></div>'),t.options.socialButtons.inshare&&(n+='<div><script type="IN/Share" data-url="'+a.socialUrl+'" data-counter="right"><\/script><script type="text/javascript">if (IN.parse) IN.parse();<\/script></div>'),t.options.socialButtons.pinterest&&"image"==a.type&&(n+='<div><a href="//www.pinterest.com/pin/create/button/?url='+o+"&media="+encodeURIComponent(a.src)+"&description="+i+'" data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a></div>'),""!=n&&(t.$socialButtonsWrapper.toggleClass("show").html(n),t.options.socialButtons.pinterest&&"image"==a.type&&e.ajax({url:"//assets.pinterest.com/js/pinit.js",dataType:"script",cache:!0}),e(this).toggleClass("show"))}})},T=function(e){var t=this.options.i18n[e];return t||e};function L(t,a){var o,i=this,s="";if(b.call(i,t,a))return i.$root=e('<div class="smbLightOverlayWrapper initializing"><div class="contentWrapper"></div></div>'),i.$root.addClass(i.options.cssClass),i.$contentWrapper=e("> div.contentWrapper",i.$root),t.length>1&&(s='<span class="navigation prev"><span></span></span><span class="navigation next"><span></span></span>'),s+='<span class="close"><span></span></span><div class="socialButtonsWrapper"></div><span class="actions socialButtonsTrigger"><span>'+T.call(i,"Share")+"</span></span>",i.$mainWrapper=e('<div class="mainWrapper"><div class="viewWrapper"><div class="images"><p>'+T.call(i,"This image is currently unavailable")+'</p></div><div class="audioVideo"></div></div>'+s+"</div>").appendTo(i.$contentWrapper),i.$itemTitle=e('<h2 class="itemTitle" />').appendTo(i.$mainWrapper),i.$loadingOverlay=e('<div class="loadingOverlay inProgress"></div>').appendTo(i.$mainWrapper),i.$imagesWrapper=e("> .viewWrapper > .images",i.$mainWrapper),i.$audioVideo=e("> .viewWrapper > .audioVideo",i.$mainWrapper),i.$socialButtonsWrapper=e(".socialButtonsWrapper",i.$mainWrapper),i.$socialButtonsTrigger=e(".socialButtonsTrigger",i.$mainWrapper),"image"==(o=i.items[i.currentItemIndex]).type?l.call(i,i.currentItemIndex,function(){c.call(i)}):c.call(i),i.$root.appendTo(i.$body),i.main={horizontalSpace:i.$mainWrapper.outerWidth(!0)-i.$mainWrapper.width(),verticalSpace:i.$mainWrapper.outerHeight(!0)-i.$mainWrapper.height()},C.call(i),i.$root.fadeTo(200,1,function(){"image"!=o.type&&$.call(i)}),x.call(i),i}function M(t,a){var o=this,i="";if(o.smbPlus=!0,b.call(o,t,a)){if(o.options.wrapperResizeDuration=0,o.$viewportMeta=e('meta[name="viewport"]'),o.oldViewportMetaContent=void 0,o.$viewportMeta.length>0?(o.oldViewportMetaContent=o.$viewportMeta.attr("content"),o.$viewportMeta.attr("content","user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1")):o.$viewportMeta=e('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />').appendTo(e("head")),o.$ieTapHighlight=e('meta[name="msapplication-tap-highlight"]'),o.oldIeTapHighlight=void 0,o.$ieTapHighlight.length>0?(o.oldIeTapHighlight=o.$ieTapHighlight.attr("content"),o.$ieTapHighlight.attr("content","no")):o.$ieTapHighlight=e('<meta name="msapplication-tap-highlight" content="no" />').appendTo(e("head")),o.$root=e('<div class="smbLightOverlayWrapper smbPlus initializing"><div class="contentWrapper"></div></div>').addClass(o.options.cssClass),/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())||(o.$root.addClass("desktopUserAgent"),o.desktopVersion=!0),o.$contentWrapper=e("> div.contentWrapper",o.$root),i='<div class="mobileOverlay"></div><div class="modalOverlay"></div>',t.length>1&&(i+='<span class="navigation prev"><span></span></span><span class="navigation next"><span></span></span>'),i+='<span class="close"><span></span></span><div class="socialButtonsWrapper"></div><span class="actions socialButtonsTrigger"><span>'+T.call(o,"Share")+"</span></span>",o.$root.append(i),o.$itemTitle=e('<h2 class="itemTitle" />').appendTo(o.$root),o.$socialButtonsWrapper=e(".socialButtonsWrapper",o.$root),o.$socialButtonsTrigger=e(".socialButtonsTrigger",o.$root),o.$modalOverlay=e("> .modalOverlay",o.$root),o.options.comments.permissions.show){var s;o.comments={},o.$root.append('<span class="actions commentsTrigger"><span>0</span></span><div class="commentsModalWrapper"><div class="main"><div class="top"><span class="comments">0</span><span class="likes">0</span><span class="sort">'+T.call(o,"Sort")+'</span></div><ul /><p class="noComments">'+T.call(o,"No comments yet")+'</p><div class="newCommentWrapper"><textarea placeholder="'+T.call(o,"Write a comment")+'"></textarea><button>'+T.call(o,"Post")+'</button></div></div><div class="anonymCommentWrapper"><p>'+T.call(o,"Add a comment")+'</p><div class="authorName"><input type="text" placeholder="'+T.call(o,"Name")+'" /></div><div class="authorEmail"><input type="text" placeholder="'+T.call(o,"Email")+'" /></div><div class="authorTextarea"><textarea placeholder="'+T.call(o,"Write a comment")+'"></textarea></div>'+(o.options.comments.requireAuthorInfo&&o.options.comments.useReCaptcha?'<div class="captchaContainer"><p class="captchaError">'+T.call(o,"Please solve the test correctly.")+'</p><div class="captcha"></div></div>':"")+'<div class="actions"><button class="cancel">'+T.call(o,"Cancel")+'</button><button class="post">'+T.call(o,"Post")+'</button></div></div><span class="closeComments">'+T.call(o,"Hide")+'</span><p class="loading">'+T.call(o,"Loading comments")+"</p></div>"),o.$commentsTrigger=e("> .actions.commentsTrigger",o.$root),o.$mainCommentsCount=e("> span",o.$commentsTrigger),o.$commentsModal=e("> .commentsModalWrapper",o.$root),o.$commentsMainWrapper=e("> .main",o.$commentsModal),o.$newCommentWrapper=e("> .newCommentWrapper",o.$commentsMainWrapper),o.$newCommentInput=e("> textarea",o.$newCommentWrapper),o.$newCommentButton=e("> button",o.$newCommentWrapper),o.$commentsTopBar=e("> .top",o.$commentsMainWrapper),o.$internalCommentsCount=e("> .comments",o.$commentsTopBar),o.$commentsLikes=e("> .likes",o.$commentsTopBar),o.$commentsSorting=e("> .sort",o.$commentsTopBar),o.$commentList=e("> ul",o.$commentsMainWrapper),o.$anonymCommentWrapper=e("> .anonymCommentWrapper",o.$commentsModal),o.$anonymCommenterNameInput=e("> .authorName > input",o.$anonymCommentWrapper),o.$anonymCommenterEmailInput=e("> .authorEmail > input",o.$anonymCommentWrapper),o.$anonymCommentInput=e("> .authorTextarea > textarea",o.$anonymCommentWrapper),o.$anonymCommentCancel=e("> .actions > .cancel",o.$anonymCommentWrapper),o.$anonymCommentPost=e("> .actions > .post",o.$anonymCommentWrapper),o.$newCommentCaptchaContainer=e("> .captchaContainer",o.$anonymCommentWrapper),o.commentSorting="asc",o.addingAjaxRequest=void 0,o.commentsOpened=!1,o.commentsAnimationTimeout,o.$commentsTrigger.on("click",function(){o.desktopVersion&&1==o.commentsOpened?o.closeComments():(o.updateItemComments(),o.desktopVersion?(o.commentsOpened=!0,clearTimeout(o.commentsAnimationTimeout),o.$root.addClass("animateComments moveComments"),o.commentsAnimationTimeout=setTimeout(function(){o.$root.removeClass("animateComments moveComments"),o.$root.width(o.$root.width()-o.$commentsModal.outerWidth(!0)),C.call(o)},200)):(o.$root.addClass("modalActive"),o.$modalOverlay.stop(!0).animate({opacity:1},{duration:200})))}),o.$commentsSorting.on("click",function(){"asc"==o.commentSorting?o.commentSorting="desc":o.commentSorting="asc",o.$commentsSorting.toggleClass("desc","desc"==o.commentSorting),k.call(o)}),o.$commentsModal.on("click","> span.closeComments",function(){o.closeComments()}),o.$newCommentInput.on("change keyup",function(){var e=o.$newCommentInput.val();o.$newCommentWrapper.toggleClass("filledIn",""!==e)}).on("focus",function(){o.options.comments.requireAuthorInfo&&(o.$anonymCommenterNameInput.trigger("focus").val("").parent().removeClass("error"),o.$anonymCommenterEmailInput.val("").parent().removeClass("error"),o.$anonymCommentInput.val("").parent().removeClass("error"),o.$newCommentCaptchaContainer.removeClass("error"),o.options.comments.useReCaptcha&&(s?grecaptcha.reset(s):s=grecaptcha.render(e("> .captcha",o.$newCommentCaptchaContainer)[0],{sitekey:o.options.googleReCaptchaSiteKey,size:"compact"})),o.$commentsModal.addClass("showAnonymWindow"))}),o.$anonymCommentCancel.on("click",function(){o.$commentsModal.removeClass("showAnonymWindow"),o.$anonymCommentWrapper.removeClass("addingAnonComment"),o.addingAjaxRequest&&(o.addingAjaxRequest.abort(),o.addingAjaxRequest=void 0)});var l=function(t,a,i,s,n,r){var m=o.currentItemIndex,l=o.items[m],c=o.comments[l.id],p=o.options.comments.requireAuthorInfo?s:o.$newCommentInput.val(),d={action:"add_comment"},h=!1;""===p||o.$newCommentWrapper.hasClass("addingComment")||(o.$newCommentCaptchaContainer.removeClass("error"),o.$newCommentInput.val(""),o.$newCommentWrapper.removeClass("filledIn").addClass("addingComment"),d.comment=p,o.options.comments.requireAuthorInfo&&(d.name=a,d.email=i),n&&(d.captcha=n),o.addingAjaxRequest=e.ajax({data:d,dataType:"json",type:"POST",url:l.comments.backend,timeout:3e4,cache:!1,error:function(){},success:function(e){null!=e.status&&("success"==e.status?(c.cache.comments.push({author:e.author.id,content:e.comment,raw:p,id:e.id,dateHtml:e.dateHtml}),c.count+=1,null==c.cache.authors[e.author.id]&&(c.cache.authors[e.author.id]={avatar:e.author.avatar,name:e.author.name,url:e.author.url})):"captcha_error"==e.status&&(o.$newCommentCaptchaContainer.addClass("error"),h=!0))},complete:function(){o.addingAjaxRequest=void 0,c.state.open&&m==o.currentItemIndex&&(r&&(o.$anonymCommentWrapper.removeClass("addingAnonComment"),o.$anonymCommentPost.text(T.call(o,"Post"))),o.$newCommentWrapper.removeClass("addingComment"),h||(r&&(o.$commentsModal.removeClass("showAnonymWindow"),o.$newCommentCaptchaContainer.removeClass("error")),k.call(o)))}}))};o.$anonymCommentPost.on("click",function(){var e=o.$anonymCommenterNameInput.val(),t=o.$anonymCommenterEmailInput.val(),a=o.$anonymCommentInput.val(),i=!1,n=void 0;o.$anonymCommenterNameInput.attr("placeholder",T.call(o,"Name")),o.$anonymCommenterEmailInput.attr("placeholder",T.call(o,"Email")),o.$anonymCommentInput.attr("placeholder",T.call(o,"Write a comment")),o.$anonymCommenterNameInput.parent().removeClass("error"),o.$anonymCommenterEmailInput.parent().removeClass("error"),o.$anonymCommentInput.parent().removeClass("error"),e||(o.$anonymCommenterNameInput.attr("placeholder",T.call(o,"Please specify your name")).parent().addClass("error"),i=!0),t&&m.test(t)||(o.$anonymCommenterEmailInput.attr("placeholder",T.call(o,"Please specify your email")).parent().addClass("error"),i=!0),a||(o.$anonymCommentInput.attr("placeholder",T.call(o,"Please write a comment")).parent().addClass("error"),i=!0),o.options.comments.useReCaptcha&&0==(n=grecaptcha.getResponse(s)).length&&(o.$newCommentCaptchaContainer.addClass("error"),i=!0),i||(o.$anonymCommentWrapper.addClass("addingAnonComment"),o.$anonymCommentPost.text(T.call(o,"Commenting")),l(0,e,t,a,n,!0))}),o.$newCommentButton.on("click",l)}o.options.like.permissions.liking&&(o.$root.append('<span class="actions likeTrigger"><span>0</span></span>'),o.$likeTrigger=e("> .actions.likeTrigger",o.$root),o.$mainLikeCount=e("> span",o.$likeTrigger),o.$likeTrigger.on("click",function(){if(!o.$root.hasClass("initializing")){var t=o.currentItemIndex,a=o.items[t],i=!a.likes.likedByUser,s={portalId:o.options.portalId,moduleId:o.options.moduleId,mediaId:a.id};a.likes.likedByUser=i,i?a.likes.numOfLikes+=1:a.likes.numOfLikes>0&&(a.likes.numOfLikes-=1),o.$mainLikeCount.text(a.likes.numOfLikes),o.$likeTrigger.toggleClass("liked",i),"number"==typeof a.journalId?(s.action="like",s.journalid=a.journalId,s.liked=i):(s.action="media_like",s.vote=i?1:-1),e.ajax({data:s,dataType:"json",type:"POST",url:o.options.websiteRoot+"DesktopModules/EasyDNNGallery/Services/SocialMediaBox.ashx",timeout:1e4,cache:!1,error:function(){},success:function(){},complete:function(){}})}})),o.$root.appendTo(o.$body),o.main={horizontalSpace:0,verticalSpace:0},e.each(o.items,function(t){var a=e("<div></div>");a.addClass("loading item_"+t).data("itemIndex",t),"image"==this.type?a.addClass("imageItem"):"video"==this.type?a.addClass("videoItem"):"audio"==this.type&&a.addClass("audioItem"),a.appendTo(o.$contentWrapper)}),C.call(o),o.$root.addClass("show"),setTimeout(function(){$.call(o)},200);var c,p=new Hammer(e("> .mobileOverlay",o.$root)[0]);return o.skipGestures=!1,p.on("swipeleft swiperight panleft panright panend tap",function(e){var a=-o.currentItemIndex*o.overlayWidth,i=e.deltaX;if("tap"==e.type)return clearTimeout(c),void(o.$root.hasClass("hideControls")?o.$root.removeClass("hideControls fadeOutControls"):(o.$root.addClass("fadeOutControls"),c=setTimeout(function(){o.$root.addClass("hideControls")},500)));if(!o.skipGestures&&o.initialItemLoaded)if(("swipeleft"==e.type||"swiperight"==e.type)&&t.length>1)"swipeleft"==e.type&&(o.currentItemIndex<o.items.length-1?y.call(o):0==o.currentItemIndex&&I.call(o));else{if("panend"==e.type){if(0==o.currentItemIndex&&i>=0||o.currentItemIndex==o.items.length-1&&i<0||Math.abs(i)<o.overlayWidth/2)return void o.$contentWrapper.removeClass(r).addClass(n).css({transform:"translate3d("+a+"px, 0, 0)"});o.skipGestures=!0;var s=-o.overlayWidth,m=1;return i>0&&(s=o.overlayWidth,m=-1),s=a+s,o.$contentWrapper.addClass(n).removeClass(r).css({transform:"translate3d("+s+"px, 0, 0)"}),void setTimeout(function(){o.skipGestures=!1,o.currentItemIndex+=m,$.call(o)},550)}(0==o.currentItemIndex&&i>=0||o.currentItemIndex==o.items.length-1&&i<0)&&((i=1-Math.abs(i)/o.overlayWidth)<.5?(i=Math.round(o.overlayWidth/4),e.deltaX<1&&(i=-i)):i=Math.round(i*e.deltaX)),o.$contentWrapper.removeClass(n).removeClass(r).css({transform:"translate3d("+(a+i)+"px, 0, 0)"})}}),x.call(o),o}}L.prototype={center:function(){var e,t,a={},o=!1,i=0,s=0,n=!1,r=!1;if(this.initialItemLoaded){switch((e=this.items[this.currentItemIndex]).type){case"image":(t=this.images[e.src].stats).isLoaded?(i=t.width,s=t.height):(i=400,s=400);break;case"video":i=e.width,s=e.height,n=!0;break;case"audio":i=460,s=36,r=!0}a=p.call(this,i,s,n,r),o=!0}o||(a.width=this.$mainWrapper.width(),a.height=this.$mainWrapper.height(),a.left=Math.floor((this.overlayWidth-(a.width+this.main.horizontalSpace))/2),a.top=Math.floor((this.overlayHeight-(a.height+this.main.verticalSpace))/2)),this.$mainWrapper.stop(!0).css(a)},showItem:function(){var t=this;t.$imagesWrapper.removeClass("imageNotLoaded"),t.$loadingOverlay.addClass("inProgress").stop(!0).fadeTo(0,1,function(){t.$loadingOverlay.css("display","")}),t.$audioVideo.html(""),e("> .viewWrapper > div",t.$mainWrapper).removeClass("activeElement"),t.$mainWrapper.removeClass("audioItem").removeClass("videoItem").removeClass("imageItem");var a=t.items[t.currentItemIndex];switch(a.type){case"image":(function(t){var a,o,i=this.images[t.src].stats;i.preloadFinished&&(this.$mainWrapper.addClass("imageItem"),e("> img",this.$imagesWrapper).removeClass("activeElement").filter(".smbLightImage_"+t.id).addClass("activeElement"),i.isLoaded?(a=i.width,o=i.height):(a=400,o=400,this.$imagesWrapper.addClass("imageNotLoaded")),this.$imagesWrapper.addClass("activeElement"),d.call(this,p.call(this,a,o)))}).call(t,a);break;case"video":h.call(t,t.currentItemIndex);break;case"audio":u.call(t,a);break;default:t.initialItemLoaded=!0}t.initialItemLoaded&&t.$root.removeClass("initializing")}},M.prototype={center:function(){var t=this,a=0;t.options.comments.permissions.show&&((a=e(">",t.$commentsModal).height()-t.$commentsTopBar.outerHeight(!0)-t.$newCommentWrapper.outerHeight(!0))<0&&(a=0),t.$commentList.css("height",a)),t.$contentWrapper.removeClass(n).removeClass(r).css({width:t.items.length*t.overlayWidth,transform:"translate3d(-"+t.currentItemIndex*t.overlayWidth+"px, 0, 0)"}),e(">",t.$contentWrapper).width(t.overlayWidth).each(function(){var a=e(this),o=a.data("itemIndex"),i=t.items[o];if(!(a.hasClass("loading")||"image"!=i.type&&o!=t.currentItemIndex))if("image"==i.type){var s=t.images[i.src].stats;e("> img",a).css(p.call(t,s.width,s.height,!1))}else"video"==i.type?e("> div",a).css(p.call(t,i.width,i.height,!0)):"audio"==i.type&&e("> div",a).css(p.call(t,460,36,!1,!0))})},showItem:function(){var t=this,a=e("> div.item_"+t.currentItemIndex,t.$contentWrapper),i=t.currentItemIndex,s=t.items[i],m=function(){i>0&&l.call(t,g.call(t,i-1)),i<t.items.length-1&&l.call(t,g.call(t,i+1))};switch(t.$contentWrapper.removeClass(n).removeClass(r).css({transform:"translate3d(-"+i*t.overlayWidth+"px, 0, 0)"}),t.options.comments.permissions.show&&(t.$newCommentInput.val(""),t.$newCommentWrapper.removeClass("filledIn"),t.comments[s.id]||(t.comments[s.id]={state:{open:!1,commentsRequest:o},count:s.comments.count,cache:{authors:{},comments:[]}}),t.$mainCommentsCount.text(t.comments[s.id].count),t.desktopVersion&&(e.each(t.comments,function(){this.state.open=!1}),t.updateItemComments())),t.options.like.permissions.liking&&(t.$likeTrigger.toggleClass("liked",s.likes.likedByUser),t.$mainLikeCount.text(s.likes.numOfLikes)),s.type){case"image":if(a.data("initialized"))return;l.call(t,i,function(){t.currentItemIndex==i&&(t.initialItemLoaded=!0,m())}),a.data("initialized",!0);break;case"video":h.call(t,t.currentItemIndex);break;case"audio":u.call(t,s);break;default:t.initialItemLoaded=!0}"image"!=s.type&&m(),t.$root.removeClass("initializing")},updateItemComments:function(){var t=this,a=t.currentItemIndex,n=t.items[a],r=t.comments[n.id];r.state.open||t.$root.hasClass("initializing")||(r.state.open=!0,r.state.commentsRequest==o?(r.state.commentsRequest=i,t.$commentsModal.addClass("loading"),e.ajax({data:{action:"list_comments"},dataType:"json",type:"GET",url:n.comments.backend,timeout:15e3,cache:!1,error:function(){r.state.commentsRequest=o},success:function(e){r.cache=e,r.count=e.comments.length,r.state.commentsRequest=s},complete:function(){r.state.open&&a==t.currentItemIndex&&(t.$commentsModal.removeClass("loading"),k.call(t))}})):(k.call(t),t.$commentsModal.removeClass("loading")),t.$internalCommentsCount.text(r.count),t.$commentsLikes.text(n.likes.numOfLikes).toggleClass("liked",n.likes.likedByUser))},closeComments:function(){var e=this,t=e.items[e.currentItemIndex];e.comments[t.id].state.open=!1,e.desktopVersion?(clearTimeout(e.commentsAnimationTimeout),e.$root.addClass("moveComments"),e.$root.css("width",""),C.call(e),e.$root.addClass("animateComments").removeClass("moveComments"),e.commentsAnimationTimeout=setTimeout(function(){e.$root.removeClass("animateComments")},300)):(e.$root.removeClass("modalActive"),e.$modalOverlay.stop(!0).animate({opacity:0},{duration:200})),e.$commentsModal.removeClass("showAnonymWindow"),e.$anonymCommentWrapper.removeClass("addingAnonComment"),e.commentsOpened=!1}},t.SmbLight_1=function(e,t){return this instanceof SmbLight_1?t.mobile?new M(e,t):new L(e,t):new SmbLight_1(e,t)}}(eds3_5_jq,window);